{% extends "base.html" %}

{% block content %}
<div class="form-container">
    <h2>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–æ–π #{{ ticket.id }}</h2>
    
    <div class="ticket-preview">
        <h3>{{ ticket.title }}</h3>
        <p>{{ ticket.description }}</p>
        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> 
            <span class="status-badge status-{{ ticket.status.value }}">
                {% if ticket.status.value == 'open' %}üî¥ –û—Ç–∫—Ä—ã—Ç–∞
                {% elif ticket.status.value == 'in_progress' %}üü° –í —Ä–∞–±–æ—Ç–µ
                {% else %}üü¢ –ó–∞–∫—Ä—ã—Ç–∞{% endif %}
            </span>
        </p>
    </div>

    {% if ticket.status.value == 'open' %}
    <div class="action-section">
        <h3>üì• –ü—Ä–∏–Ω—è—Ç—å –∑–∞—è–≤–∫—É –≤ —Ä–∞–±–æ—Ç—É</h3>
        <p>–ù–∞–∑–Ω–∞—á—å—Ç–µ —Å–µ–±—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º –∏ –∏–∑–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –Ω–∞ "–í —Ä–∞–±–æ—Ç–µ"</p>
        <form method="POST">
            <input type="hidden" name="action" value="assign">
            <button type="submit" class="btn btn-warning">‚úÖ –ü—Ä–∏–Ω—è—Ç—å –∑–∞—è–≤–∫—É</button>
        </form>
    </div>
    {% endif %}

    {% if ticket.status.value == 'in_progress' %}
    <div class="action-section">
        <h3>‚úÖ –ó–∞–∫—Ä—ã—Ç—å –∑–∞—è–≤–∫—É</h3>
        <p>–ó–∞–≤–µ—Ä—à–∏—Ç–µ —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –∑–∞—è–≤–∫–æ–π –∏ —É–∫–∞–∂–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</p>
        <form method="POST">
            <input type="hidden" name="action" value="close">
            
            <div class="form-group">
                <label for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∑–∞–∫—Ä—ã—Ç–∏—è:</label>
                <textarea id="comment" name="comment" rows="4" required
                          placeholder="–û–ø–∏—à–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã..."></textarea>
            </div>
            
            <button type="submit" class="btn btn-success">‚úÖ –ó–∞–∫—Ä—ã—Ç—å –∑–∞—è–≤–∫—É</button>
        </form>
    </div>
    {% endif %}

    {% if ticket.status.value == 'closed' %}
    <div class="alert alert-info">
        <h3>‚úÖ –ó–∞—è–≤–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞</h3>
        <p>–≠—Ç–∞ –∑–∞—è–≤–∫–∞ —É–∂–µ –±—ã–ª–∞ –∑–∞–∫—Ä—ã—Ç–∞ {{ ticket.closed_at.strftime('%d.%m.%Y %H:%M') }}</p>
        {% if ticket.closing_comment %}
        <p><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> {{ ticket.closing_comment }}</p>
        {% endif %}
    </div>
    {% endif %}

    <div class="action-buttons">
        <a href="{{ url_for('ticket_detail', ticket_id=ticket.id) }}" 
           class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –∑–∞—è–≤–∫–µ</a>
        <a href="{{ url_for('tickets_list') }}" class="btn btn-primary">üìã –ö —Å–ø–∏—Å–∫—É –∑–∞—è–≤–æ–∫</a>
    </div>
</div>
{% endblock %}
